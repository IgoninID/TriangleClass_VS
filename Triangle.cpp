#include <cmath>
#include <string>
#include <fstream>
#include <cassert>
#include "Triangle.h"

    /// <summary>
    /// конструктор без параметров
    /// </summary>
    Triangle_coord::Triangle_coord()
    {
        x1_coord = 0;
        x2_coord = 0;
        x3_coord = 0;
        y1_coord = 0;
        y2_coord = 0;
        y3_coord = 0;
    }

/// <summary>
/// конструктор без параметров
/// </summary>
Triangle_sides::Triangle_sides()
{
    side_A = 0;
    side_B = 0;
    side_C = 0;
}

/// <summary>
/// конструктор с параметрами для координат вершин треугольника
/// правило: две вершины не должны быть с одинаковыми коодинатами
/// </summary>
/// <param name="x1_coord - координата x первой вершины"></param>
/// <param name="x2_coord - координата x второй вершины"></param>
/// <param name="x3_coord - координата x третьей вершины"></param>
/// <param name="y1_coord - координата y первой вершины"></param>
/// <param name="y2_coord - координата y второй вершины"></param>
/// <param name="y3_coord - координата y третьей вершины"></param>
Triangle_coord::Triangle_coord(double x1_coord, double y1_coord, double x2_coord, double y2_coord, double x3_coord, double y3_coord)
{
    set_all_vert(x1_coord, y1_coord, x2_coord, y2_coord, x3_coord, y3_coord);
}

/// <summary>
/// конструктор с параметрами для сторон треугольника
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны
/// </summary>
/// <param name="side_A - первая сторона треугольника"></param>
/// <param name="side_B - вторая сторона треугольника"></param>
/// <param name="side_C - третья сторона треугольника"></param>
Triangle_sides::Triangle_sides(double side_A, double side_B, double side_C)
{
    set_sides(side_A, side_B, side_C);
}

/// <summary>
/// ввод координаты x первой вершины
/// </summary>
/// <param name="x - координата x"></param>
void Triangle_coord::set_x1_coord(double x)
{
    x1_coord = x;
}

/// <summary>
/// ввод координаты x второй вершины
/// </summary>
/// <param name="x - координата x"></param>
void Triangle_coord::set_x2_coord(double x)
{
    x2_coord = x;
}

/// <summary>
/// ввод координаты x третьей вершины
/// </summary>
/// <param name="x - координата x"></param>
void Triangle_coord::set_x3_coord(double x)
{
    x3_coord = x;
}

/// <summary>
/// ввод координаты y первой вершины
/// </summary>
/// <param name="y - координата y"></param>
void Triangle_coord::set_y1_coord(double y)
{
    y1_coord = y;
}

/// <summary>
/// ввод координаты y второй вершины
/// </summary>
/// <param name="y - координата y"></param>
void Triangle_coord::set_y2_coord(double y)
{
    y2_coord = y;
}

/// <summary>
/// ввод координаты x третьей вершины
/// </summary>
/// <param name="y - координата y"></param>
void Triangle_coord::set_y3_coord(double y)
{
    y3_coord = y;
}

/// <summary>
/// ввод первой вершины
/// </summary>
/// <param name="x - координата x"></param>
/// <param name="y - координата y"></param>
void Triangle_coord::set_first_vert(double x, double y)
{
    set_x1_coord(x);
    set_y1_coord(y);
}

/// <summary>
/// ввод второй вершины
/// </summary>
/// <param name="x - координата x"></param>
/// <param name="y - координата y"></param>
void Triangle_coord::set_second_vert(double x, double y)
{
    set_x2_coord(x);
    set_y2_coord(y);
}

/// <summary>
/// ввод третьей вершины
/// </summary>
/// <param name="x - координата x"></param>
/// <param name="y - координата y"></param>
void Triangle_coord::set_third_vert(double x, double y)
{
    set_x3_coord(x);
    set_y3_coord(y);
}

/// <summary>
/// ввод вершин треугольника.
/// правило: две вершины не должны быть с одинаковыми коодинатами
/// </summary>
/// <param name="x1 - координата x первой вершины"></param>
/// <param name="y1 - координата y первой вершины"></param>
/// <param name="x2 - координата x второй вершины"></param>
/// <param name="y2 - координата y второй вершины"></param>
/// <param name="x3 - координата x третьей вершины"></param>
/// <param name="y3 - координата y третьей вершины"></param>
void Triangle_coord::set_all_vert(double x1, double y1, double x2, double y2, double x3, double y3)
{
    if (((x1 == y1) && (x1 == x2) && (x2 == y2)) || ((x1 == y1) && (x1 == x3) && (x3 == y3)) || ((x2 == y2) && (x2 == x3) && (x3 == y3)))
    {
        set_first_vert(0, 0);
        set_second_vert(0, 0);
        set_third_vert(0, 0);
    }
    else
    {
        set_first_vert(x1, y1);
        set_second_vert(x2, y2);
        set_third_vert(x3, y3);
    }
}

/// <summary>
/// ввод первой стороны треугольника.
/// правило: неотрицательное число
/// </summary>
/// <param name="side"></param>
void Triangle_sides::set_sideA(double side)
{
    if (side >= 0)
        side_A = side;
    else
        side_A = 0;
}

/// <summary>
/// ввод второй стороны треугольника.
/// правило: неотрицательное число
/// </summary>
/// <param name="side"></param>
void Triangle_sides::set_sideB(double side)
{
    if (side >= 0)
        side_B = side;
    else
        side_B = 0;
}

/// <summary>
/// ввод третьей стороны треугольника.
/// правило: неотрицательное число
/// </summary>
/// <param name="side"></param>
void Triangle_sides::set_sideC(double side)
{
    if (side >= 0)
        side_C = side;
    else
        side_C = 0;
}

/// <summary>
/// ввод сторон треугольника.
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны
/// </summary>
/// <param name="fside - первая сторона треугольника"></param>
/// <param name="sside - вторая сторона треугольника"></param>
/// <param name="tside - третья сторона треугольника"></param>
void Triangle_sides::set_sides(double fside, double sside, double tside)
{
    if ((fside + sside <= tside) || (sside + tside <= fside) || (fside + tside <= sside))
    {
        set_sideA(0);
        set_sideB(0);
        set_sideC(0);
    }
    else
    {
        set_sideA(fside);
        set_sideB(sside);
        set_sideC(tside);
    }
}

/// <summary>
/// вывод координаты x первой вершины
/// </summary>
/// <returns>
/// координата x первой вершины
/// </returns>
double Triangle_coord::get_x1_coord() const
{
    return x1_coord;
}

/// <summary>
/// вывод координаты x второй вершины 
/// </summary>
/// <returns>
///  координата x второй вершины
/// </returns>
double Triangle_coord::get_x2_coord() const
{
    return x2_coord;
}

/// <summary>
/// вывод координаты x третьей вершины 
/// </summary>
/// <returns>
///  координата x третьей вершины
/// </returns>
double Triangle_coord::get_x3_coord() const
{
    return x3_coord;
}

/// <summary>
/// вывод координаты y первой вершины 
/// </summary>
/// <returns>
/// координата y первой вершины
/// </returns>
double Triangle_coord::get_y1_coord() const
{
    return y1_coord;
}

/// <summary>
/// вывод координаты y второй вершины 
/// </summary>
/// <returns>
/// координата y второй вершины
/// </returns>
double Triangle_coord::get_y2_coord() const
{
    return y2_coord;
}

/// <summary>
/// вывод координаты y третьей вершины
/// </summary>
/// <returns>
/// координата y третьей вершины
/// </returns>
double Triangle_coord::get_y3_coord() const
{
    return y3_coord;
}

/// <summary>
/// вывод первой стороны треугольника
/// </summary>
/// <returns>
/// длина первой стороны треугольника
/// </returns>
double Triangle_sides::get_sideA() const
{
    return side_A;
}

/// <summary>
/// вывод второй стороны треугольнка
/// </summary>
/// <returns>
/// длина второй стороны треугольника
/// </returns>
double Triangle_sides::get_sideB() const
{
    return side_B;
}

/// <summary>
/// вывод третьей стороны треугольнка
/// </summary>
/// <returns>
/// длина третьей стороны треугольника
/// </returns>
double Triangle_sides::get_sideC() const
{
    return side_C;
}

/// <summary>
/// вычисление стороны треугольника.
/// </summary>
/// <param name="first_x - координата x одной вершины"></param>
/// <param name="first_y - координата y одной вершины"></param>
/// <param name="second_x - координата x другой вершины"></param>
/// <param name="second_y - координата y другой вершины"></param>
/// <returns>
/// длина стороны треугольника
/// </returns>
double calc_side(double first_x, double first_y, double second_x, double second_y)
{
    return sqrt(((first_x - second_x) * (first_x - second_x)) + ((first_y - second_y) * (first_y - second_y))); // Возвращает длину стороны треугольника по формуле
}

/// <summary>
/// вычисление периметра.
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны 
/// </summary>
/// <returns>
/// периметр треугольника
/// </returns>
double Triangle_coord::calc_perim() const
{
    double P;
        double side1 = calc_side(get_x1_coord(), get_y1_coord(), get_x2_coord(), get_y2_coord());
        double side2 = calc_side(get_x1_coord(), get_y1_coord(), get_x3_coord(), get_y3_coord());
        double side3 = calc_side(get_x2_coord(), get_y2_coord(), get_x3_coord(), get_y3_coord());
    if ((((side1 + side2) > side3) && ((side2 + side3) > side1) && ((side1 + side3) > side2)) && ((side1 > 0.0) && (side2 > 0.0) && (side3 > 0.0))) // если сумма двух сторон треугольника меньше или равна третьей стороне
        P = side1 + side2 + side3; // Возвращает сумму трех сторон треугольника(периметр)
    else
        P = 0;
    return P;
}

/// <summary>
/// вычисление периметра.
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны 
/// </summary>
/// <returns>
/// периметр треугольника
/// </returns>
double Triangle_sides::calc_perim() const
{
    double P;
    if (((get_sideA() + get_sideB()) > get_sideC()) && ((get_sideB() + get_sideC()) > get_sideA()) && ((get_sideA() + get_sideC()) > get_sideB()) && (get_sideA() > 0) && (get_sideB() > 0) && (get_sideC() > 0)) // если сумма двух сторон треугольника меньше или равна третьей стороне
        P = get_sideA() + get_sideB() + get_sideA(); // Возвращает сумму трех сторон треугольника(периметр)
    else
        P = 0;
    return P;
}

/// <summary>
/// вычисление площади.
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны
/// </summary>
/// <returns>
/// площадь треугольника
/// </returns>
double Triangle_coord::calc_area() const
{
    double S;
    double side1 = calc_side(get_x1_coord(), get_y1_coord(), get_x2_coord(), get_y2_coord());
    double side2 = calc_side(get_x1_coord(), get_y1_coord(), get_x3_coord(), get_y3_coord());
    double side3 = calc_side(get_x2_coord(), get_y2_coord(), get_x3_coord(), get_y3_coord());
    if ((((side1 + side2) > side3) && ((side2 + side3) > side1) && ((side1 + side3) > side2)) && ((side1 > 0.0) && (side2 > 0.0) && (side3 > 0.0))) // если сумма двух сторон треугольника меньше или равна третьей стороне
    {
        double P = side1 + side2 + side3;
        S = sqrt((P / 2) * ((P / 2) - side1) * ((P / 2) - side2) * ((P / 2) - side3)); // Возвращает периметр треугольника по формуле Герона
    }
    else
        S = 0;
    return S;
}

/// <summary>
/// вычисление площади.
/// правило: сумма двух сторон треугольника должна быть больше третьей стороны
/// </summary>
/// <returns>
/// площадь треугольника
/// </returns>
double Triangle_sides::calc_area() const
{
    double S;
    if (((get_sideA() + get_sideB()) > get_sideC()) && ((get_sideB() + get_sideC()) > get_sideA()) && ((get_sideA() + get_sideC()) > get_sideB()) && (get_sideA() > 0) && (get_sideB() > 0) && (get_sideC() > 0)) // если сумма двух сторон треугольника меньше или равна третьей стороне
    {
        double P = get_sideA() + get_sideB() + get_sideC();
        S = sqrt((P / 2) * ((P / 2) - get_sideA()) * ((P / 2) - get_sideB()) * ((P / 2) - get_sideC())); // Возвращает периметр треугольника по формуле Герона
    }
    else
        S = 0;
    return S;
}

/// <summary>
/// вывод информации о треугольнике
/// </summary>
/// <returns>
/// строка с информацией о треугольнике: координаты вершин, длина сторон, периметр и площадь
/// </returns>
std::string Triangle_coord::to_string() const
{
    std::string s =
        "Vertexs: (" + std::to_string(get_x1_coord()) + " ; " + std::to_string(get_y1_coord()) + "), (" +
                       std::to_string(get_x2_coord()) + " ; " + std::to_string(get_y2_coord()) + "), (" +
                       std::to_string(get_x3_coord()) + " ; " + std::to_string(get_y3_coord()) + ")\n" +
        "Perimeter: " + std::to_string(calc_perim()) + "\n" +
        "Area: " + std::to_string(calc_area()) + "\n";
    return s;
}

/// <summary>
/// вывод информации о треугольнике
/// </summary>
/// <returns>
/// строка с информацией о треугольнике: координаты вершин, длина сторон, периметр и площадь
/// </returns>
std::string Triangle_sides::to_string() const
{
    std::string s =
        "Sides: " + std::to_string(get_sideA()) + " ; " +
        std::to_string(get_sideB()) + " ; " +
        std::to_string(get_sideC()) + "\n" +
        "Perimeter: " + std::to_string(calc_perim()) + "\n" +
        "Area: " + std::to_string(calc_area()) + "\n";
    return s;
}

void Triangle_sides::Safe_file(const std::string& name) const
{
    std::ofstream savefile(name);
    if (!savefile.is_open())
    {
        throw "Не удается открыть файл для записи";
    }
    else
    {
        savefile << get_sideA() << "\n";
        savefile << get_sideB() << "\n";
        savefile << get_sideC() << "\n";
        savefile << calc_perim() << "\n";
        savefile << calc_area() << "\n";
        savefile.close();
    }

}

Triangle_sides Triangle_sides::Load_file(const std::string& name)
{
    std::ifstream loadfile(name);
    if (!loadfile.is_open())
    {
        throw "Не удается открыть файл для чтения";
    }
    else
    {
        double side1, side2, side3;
        loadfile >> side1 >> side2 >> side3;
        set_sides(side1, side2, side3);
        loadfile.close();
    }
}

void Triangle_coord::Safe_file(const std::string& name) const
{
    std::ofstream savefile(name);
    if (!savefile.is_open())
    {
        throw "Не удается открыть файл для записи";
    }
    else
    {
        savefile << get_x1_coord() << "\n";
        savefile << get_y1_coord() << "\n";
        savefile << get_x2_coord() << "\n";
        savefile << get_y2_coord() << "\n";
        savefile << get_x3_coord() << "\n";
        savefile << get_y3_coord() << "\n";
        savefile << calc_perim() << "\n";
        savefile << calc_area() << "\n";
        savefile.close();
    }
}

Triangle_coord Triangle_coord::Load_file(const std::string& name)
{
    std::ifstream loadfile(name);
    if (!loadfile.is_open())
    {
        throw "Не удается открыть файл для чтения";
    }
    else
    {
        double x1, x2, x3, y1, y2, y3;
        loadfile >> x1 >> y1 >> x2 >> y2 >> x3 >> y3;
        set_all_vert(x1, y1, x2, y2, x3, y3);
        loadfile.close();
    }
}

/// <summary>
/// проверка работы методов и функций
/// </summary>
void test()
{
    Triangle Test1;
    Test1.TriangleS = new Triangle_sides(11, 11, 11);
    Triangle Test2;
    Test2.TriangleC = new Triangle_coord(-1, 2, 4, -5, 9, 10);
    Triangle Test3;
    Test3.TriangleS = new Triangle_sides;
    Test3.TriangleS->set_sides(12, 13, 14);
    Triangle Test4;
    Test4.TriangleC = new Triangle_coord;
    Test4.TriangleC->set_all_vert(-1, 5, 5, 5, -7, -6);

    assert(abs(Test3.TriangleS->get_sideA() - 12) < 0.00001); //проверка методов
    assert(abs(Test3.TriangleS->get_sideB() - 13) < 0.00001);
    assert(abs(Test3.TriangleS->get_sideC() - 14) < 0.00001);
    assert(abs(Test1.TriangleS->calc_perim() - 33) < 0.00001);
    assert(abs(Test2.TriangleC->get_x1_coord() - (-1)) < 0.00001);
    assert(abs(Test2.TriangleC->get_y1_coord() - (2)) < 0.00001);
    assert(abs(Test2.TriangleC->get_x2_coord() - (4)) < 0.00001);
    assert(abs(Test2.TriangleC->get_y2_coord() - (-5)) < 0.00001);
    assert(abs(Test2.TriangleC->get_x3_coord() - (9)) < 0.00001);
    assert(abs(Test2.TriangleC->get_y3_coord() - (10)) < 0.00001);
    assert(abs(Test2.TriangleC->calc_area() - 55.0) < 0.00001);
    assert(Test1.TriangleS->to_string() == ("Sides: 11.000000 ; 11.000000 ; 11.000000\nPerimeter: 33.000000\nArea: 52.394537\n"));

    assert(abs(Test4.TriangleC->get_x1_coord() - (-1)) < 0.00001);
    assert(abs(Test4.TriangleC->get_y1_coord() - (5)) < 0.00001);
    assert(abs(Test4.TriangleC->get_x2_coord() - (5)) < 0.00001);
    assert(abs(Test4.TriangleC->get_y2_coord() - (5)) < 0.00001);
    assert(abs(Test4.TriangleC->get_x3_coord() - (-7)) < 0.00001);
    assert(abs(Test4.TriangleC->get_y3_coord() - (-6)) < 0.00001);
    assert(abs(Test4.TriangleC->calc_perim() - (34.80878)) < 0.00001);
    assert(abs(Test4.TriangleC->calc_area() - (33)) < 0.00001);
    assert(Test4.TriangleC->to_string() == ("Vertexs: (-1.000000 ; 5.000000), (5.000000 ; 5.000000), (-7.000000 ; -6.000000)\nPerimeter: 34.808785\nArea: 33.000000\n"));
}